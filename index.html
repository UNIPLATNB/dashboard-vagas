<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Consulta de Vagas – Secretaria de Educação</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
}
h1 {
  margin-bottom: 10px;
}
select {
  padding: 6px;
  margin-bottom: 15px;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: left;
}
th {
  background: #f0f0f0;
}
</style>
</head>

<body>

<h1>Consulta de vagas por Região</h1>

<label>Região:</label>
<select id="regiaoSelect">
  <option value="">Selecione</option>
</select>

<table>
  <thead>
    <tr>
      <th>Unidade Escolar</th>
      <th>Etapa</th>
      <th>Ano / Série</th>
      <th>Vagas</th>
    </tr>
  </thead>
  <tbody id="tabelaDados"></tbody>
</table>

<script>
const url = "https://docs.google.com/spreadsheets/d/1n2be7xn-2u-zP1nOT7nKPZZ4_dPqK6k__zgyyhIqZ_w/gviz/tq?tqx=out:json";

let dados = [];

fetch(url)
  console.log("Tentando carregar dados da planilha...");
  .then(res => res.arrayBuffer())
  .then(buffer => {
    const wb = XLSX.read(buffer, { type: "array" });

    wb.SheetNames.forEach(nomeAba => {
      const sheet = wb.Sheets[nomeAba];
      const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

      // Começa na linha 5 (índice 4)
      for (let i = 4; i < rows.length; i++) {
        const r = rows[i];
        const escola = r[1];
        if (!escola) continue;

        const etapas = [
          { etapa: "Ensino Infantil", ano: r[3], vagas: r[4] },
          { etapa: "EF Anos Iniciais", ano: r[6], vagas: r[7] },
          { etapa: "EF Anos Finais", ano: r[9], vagas: r[10] },
          { etapa: "Ensino Médio", ano: r[12], vagas: r[13] },
          { etapa: "EJA (Noturno)", ano: r[15], vagas: r[16] }
        ];

        etapas.forEach(e => {
          dados.push({
            regiao: nomeAba,
            escola,
            etapa: e.etapa,
            ano: e.ano || "",
            vagas: e.vagas || 0
          });
        });
      }
    });
console.log("Total de registros lidos:", dados.length);
    carregarRegioes();
  });

function carregarRegioes() {
  const select = document.getElementById("regiaoSelect");
  const regioes = [...new Set(dados.map(d => d.regiao))];

  regioes.forEach(r => {
    const opt = document.createElement("option");
    opt.value = r;
    opt.textContent = r;
    select.appendChild(opt);
  });
}

document.getElementById("regiaoSelect").addEventListener("change", e => {
  const regiao = e.target.value;
  const tbody = document.getElementById("tabelaDados");
  tbody.innerHTML = "";

  dados
    .filter(d => d.regiao === regiao)
    .forEach(d => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${d.escola}</td>
        <td>${d.etapa}</td>
        <td>${d.ano}</td>
        <td>${d.vagas}</td>
      `;
      tbody.appendChild(tr);
    });
});
</script>

</body>
</html>

