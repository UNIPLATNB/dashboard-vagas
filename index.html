<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Dashboard de Vagas Escolares</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    select {
      padding: 6px;
      font-size: 16px;
      margin-bottom: 20px;
    }
    .escola {
      border: 1px solid #ccc;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 6px;
    }
    .etapa {
      margin-left: 15px;
      margin-top: 5px;
    }
    .vaga {
      font-weight: bold;
      color: green;
    }
    .sem-vaga {
      color: #999;
    }
  </style>
</head>
<body>

<h2>Consulta de Vagas por Região</h2>

<select id="regiaoSelect">
  <option value="">Selecione a Região</option>
</select>

<div id="resultado"></div>

<script>
const SHEET_ID = "1n2be7xn-2u-zP1nOT7nKPZZ4_dPqK6k__zgyyhIqZ_w";
const GID = "0"; // se for a primeira aba

const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${GID}`;

fetch(URL)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(text.substring(47).slice(0, -2));
    const rows = json.table.rows;

    const dados = rows.map(r => r.c.map(c => c ? c.v : ""));

    const regioes = [...new Set(dados.map(l => l[0]).filter(Boolean))];

    const select = document.getElementById("regiaoSelect");

    regioes.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r;
      opt.textContent = r;
      select.appendChild(opt);
    });

    select.addEventListener("change", () => render(dados, select.value));
  });

function render(dados, regiao) {
  const container = document.getElementById("resultado");
  container.innerHTML = "";

  if (!regiao) return;

  const filtrados = dados.filter(l => l[0] === regiao);

  filtrados.forEach(linha => {
    const escola = linha[1];

    const etapas = [
      { nome: "Ensino Infantil", anos: linha[3], vagas: linha[4] },
      { nome: "Ensino Fundamental Anos Iniciais", anos: linha[6], vagas: linha[7] },
      { nome: "Ensino Fundamental Anos Finais", anos: linha[9], vagas: linha[10] },
      { nome: "Ensino Médio", anos: linha[12], vagas: linha[13] },
      { nome: "EJA (NOTURNO)", anos: linha[15], vagas: linha[16] }
    ];

    const div = document.createElement("div");
    div.className = "escola";
    div.innerHTML = `<h3>${escola}</h3>`;

    etapas.forEach(e => {
      if (e.anos) {
        const vagasTxt = e.vagas > 0
          ? `<span class="vaga">${e.vagas} vaga(s)</span>`
          : `<span class="sem-vaga">0 vagas</span>`;

        div.innerHTML += `
          <div class="etapa">
            <strong>${e.nome}</strong><br>
            Anos/Séries: ${e.anos}<br>
            ${vagasTxt}
          </div>
        `;
      }
    });

    container.appendChild(div);
  });
}
</script>

</body>
</html>
